@page "/"
@using Superkatten.Katministratie.Application.Contracts
@using Superkatten.Katministratie.Web.Services
@using Superkatten.Katministratie.Web.Components

<PageTitle>Superkatten</PageTitle>

<h1>Superkatten</h1>

@if (Superkatten is null)
{
    <p>Geen superkatten in het systeem...</p>
}
else
{
    <ul>
    @foreach (var superkatEntry in Superkatten)
    {
        <li><SuperkatComponent SuperkatContext=superkatEntry /></li>
    }
    </ul>
    <Button Color="ButtonColor.Primary" @onclick="Previous">Previous</Button>
    <button> - @StartIndex - </button>
    <Button Color="ButtonColor.Primary" @onclick="Next">Next</Button>
}


@code {
    [Inject]
    public ISuperkattenListService? _superkattenService { get; set; }

    public List<Superkat> Superkatten { get; set; } = new List<Superkat>();

    private int StartIndex { get; set; } = 0;

    public void Next()
    {
        if (StartIndex <= Superkatten.Count - 5 )
        {
            StartIndex += 5;
            UpdateListAsync();
        }
    }

    public void Previous()
    {
        if (StartIndex >= 5)
        {
            StartIndex -= 5;
            UpdateListAsync();
        }
    }

    protected override async Task OnInitializedAsync() => await UpdateListAsync();

    private async Task UpdateListAsync()
    {
        if (_superkattenService == null)
        {
            return;
        }

        var superkatten = await _superkattenService.GetAllSuperkattenAsync();
        Superkatten = superkatten
            .AsQueryable()
            .Where(s => s.Number >= StartIndex)
            .Take(5)
            .OrderByDescending(sk => sk.Number)
            .ToList();
    }
}