@page "/CreateGastgezin"

@using Superkatten.Katministratie.Host.Services
@using Superkatten.Katministratie.Host.Entities

@inject NavigationManager _navigationManager
@inject IGastgezinService _gastgezinService
@inject MessageService _message

<h3>Aanmaken van een gastgezin</h3>

<PageTitle>Nieuwe superkat</PageTitle>

<Row Class="mb-2">
    <Col Class="col-4">
        <Button Block="@true" Disabled="@ValidName" OnClick="@OnOk">Ok</Button>
    </Col>
    <Col Class="col-4">
        <Button Block="@true" OnClick="@OnCancel">Terug</Button>
    </Col>
</Row>

<Row Class="mb-2">
    <Col Class="col-12">
        <Input Placeholder="Voer de naam in"  Size="@InputSize.Large" @bind-Value="@parameters.Name" >
            <Prefix>
                <Icon Type="border-inner" />
            </Prefix>
        </Input>
    </Col>
</Row>

<Row Class="mb-2">
    <Col Class="col-12">
        <Input Placeholder="Voer het adres in"  Size="@InputSize.Large" @bind-Value="@parameters.Address" >
            <Prefix>
                <Icon Type="border-inner" />
            </Prefix>
        </Input>
    </Col>
</Row>

<Row Class="mb-2">
    <Col Class="col-12">
        <Input Placeholder="Voer de woonplaats in"  Size="@InputSize.Large" @bind-Value="@parameters.City" >
            <Prefix>
                <Icon Type="border-inner" />
            </Prefix>
        </Input>
    </Col>
</Row>

<Row Class="mb-2">
    <Col Class="col-12">
        <Input Placeholder="Voer het telefoonnummer in"  Size="@InputSize.Large" @bind-Value="@parameters.Phone" >
            <Prefix>
                <Icon Type="border-inner" />
            </Prefix>
        </Input>
    </Col>
</Row>

@code {
    private CreateOrUpdateGastgezinParameters parameters =
                    new CreateOrUpdateGastgezinParameters()
                    {
                        Name = string.Empty,
                        Address = string.Empty,
                        City = string.Empty,
                        Phone = string.Empty
                    };
                    
    private bool ValidName => string.IsNullOrWhiteSpace(parameters.Name);

    public async Task OnOk()
    {
        await StoreGastgezin();
        _navigationManager.NavigateTo("OverviewGastgezinnen");
    }

    public void OnCancel()
    {
        _navigationManager.NavigateTo("OverviewGastgezinnen");
    }

    private async Task StoreGastgezin()
    {
        var gastgezin = await _gastgezinService.CreateGastgezinAsync(parameters);
        if (gastgezin is null)
        {
            await _message.Error($"Fout bij het opslaan van een nieuw gastgezin.", 3);
            return;
        }

        await _message.Success($"Gastgezin {gastgezin.Name} is opgeslagen.", 3);        
    }
}
