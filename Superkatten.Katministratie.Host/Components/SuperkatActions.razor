@using Superkatten.Katministratie.Application.Contracts
@using Superkatten.Katministratie.Web.Services

@inject ISuperkatActionService _superkatActionService

<div class="container">
    <div class="row">
            <div class="col-4">
                <SuperkatAction                
                    OnClickCallback="@ToggleReserve" 
                    TooltipText="Reserveren van een kat" 
                    ActionIcon="@(Superkat.Reserved ? "favorite_border" : "do_not_disturb")" />
            </div>

            <div class="col-4">
                <SuperkatAction 
                OnClickCallback="@ToggleRetour" 
                TooltipText="Kat gaat terug naar vanglocatie" 
                ActionIcon="@(Superkat.Retour ? "autorenew" : "arrow_forward")" />
            </div>
    </div>
</div>

@code {
    [Parameter]
    public Superkat Superkat { get; set; } = new();

    [Parameter]
    public EventCallback<Superkat> SuperkatChanged { get; set; }

    private bool BusyWithAction = true;

    private async Task ToggleReserve()
    {
        BusyWithAction = true;
        await _superkatActionService.ToggleReserveSuperkatAsync(Superkat.Number);
        await UpdateSuperkat(!Superkat.Reserved, Superkat.Retour);
        BusyWithAction = false;
    }

    private async Task ToggleRetour()
    {
        BusyWithAction = true;
        await _superkatActionService.ToggleRetourSuperkatAsync(Superkat.Number);
        await UpdateSuperkat(Superkat.Reserved, !Superkat.Retour);
        BusyWithAction = false;
    }

    private async Task UpdateSuperkat(bool reserve, bool retour)
    {
        await SuperkatChanged.InvokeAsync(Superkat = new Superkat
        {
            Name = Superkat.Name,
            Birthday = Superkat.Birthday,
            CatchLocation = Superkat.CatchLocation,
            FoundDate = Superkat.FoundDate,
            Number = Superkat.Number,
            SuperkatColor = Superkat.SuperkatColor,
            Reserved = reserve,
            Retour = retour
        });
    }
}
